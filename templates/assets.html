{% extends "base.html" %}
{% block content %}
<div class="page-header">
  <div>
    <h1>資産一覧</h1>
    <p>資産の一覧を表示します。</p>
    <p class="summary">件数: {{ assets | length }}</p>
  </div>
  <div class="actions">
    <a class="button" href="/assets/new">新規登録</a>
  </div>
</div>

<div class="assets-layout">
  <section class="filter-panel panel">
    <div class="filter-header">
      <h2>フィルタ</h2>
    </div>
    <form method="get" class="form">
      <label>
        ステータス
        <input type="text" name="status" value="{{ filters.status }}" placeholder="INV/READY..." />
      </label>
      <label>
        資産No
        <input type="text" name="asset_tag" value="{{ filters.asset_tag }}" />
      </label>
      <label>
        場所
        <input type="text" name="location" value="{{ filters.location }}" />
      </label>
      <div class="form-actions">
        <button type="submit" class="button">検索</button>
      </div>
    </form>

    {% if filters.status or filters.asset_tag or filters.location %}
      <div class="filter-summary">
        フィルタ:
        {% if filters.status %}ステータス={{ filters.status }}{% endif %}
        {% if filters.asset_tag %} 資産No={{ filters.asset_tag }}{% endif %}
        {% if filters.location %} 場所={{ filters.location }}{% endif %}
      </div>
    {% endif %}

  </section>

  <section class="list-panel">
    <div class="list-header">
      <span class="summary">件数: {{ assets | length }}</span>
    </div>
    <div class="list-scroll">
      <table>
        <thead>
          <tr><th>ID</th><th>資産No</th><th>状態</th><th>利用者</th><th>場所</th><th>状態遷移</th></tr>
        </thead>
        <tbody>
          {% for asset in assets %}
            <tr>
              <td><a href="/assets/{{ asset.id }}">{{ asset.id }}</a></td>
              <td>{{ asset.asset_tag }}</td>
              <td>{{ status_labels.get(asset.status, asset.status) }}</td>
              <td>{{ asset.current_user or "" }}</td>
              <td>{{ asset.location or "" }}</td>
              <td>
                <form method="post" action="/assets/{{ asset.id }}/transition">
                  <select name="to_status" required>
                    {% for target in targets[asset.id] %}
                      <option value="{{ target }}">{{ status_labels.get(target, target) }}</option>
                    {% endfor %}
                  </select>
                  <input type="text" name="reason" placeholder="理由" />
                  <button type="submit" class="button">更新</button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="6">データがありません。</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="import-panel panel">
    <h3>インポート</h3>
    <form method="post" action="/assets/import" class="form" enctype="multipart/form-data">
      <label>
        インポート（CSV）
        <input type="file" name="file" accept=".csv" />
      </label>
      <div class="form-actions">
        <button type="submit" class="button">インポート</button>
      </div>
    </form>
  </section>
</div>
{% endblock %}
